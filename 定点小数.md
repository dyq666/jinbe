## 定点小数

这里讨论的小数指的是有符号的纯小数, 定点代表小数点的位置是固定的.

例如在 8 bit 中, 最高位是符号位, 其余是数值位, 小数点在符号位和数值位之间. 例如, 原码 0001 1001 的真值是 0.001 1001, 原码 1001 1001 的真值是 -0.001 1001.

### 原码表示法

原码离散范围: [1111 1111, 0111 1111], 对应真值离散范围: [-0.111 1111, 0.111 1111].

和整数相同的是, 1000 0000, 0000 0000 都代表真值 0, 因而总共有 $2^8 - 1$ 种数据.

和整数不同的是, 小数的范围是离散的, 两个小数之间有无数个小数, 而 8 bit 原码只有 $2^8 - 1$ 种数据. 因此使用有限的数存储无限的数, 就会导致精度丢失.

十进制的真值离散范围: [$-(1 - 2^{-7})$, $1 - 2^{-7}$], 由等比数列求和公式 $(a_nq - a_1) / (q -1)$ 计算得到, 0.111 1111 = ($2^{-7} * 1/2 - 2^{-1}) / (1/2 - 1)$ = $-2 * (2^{-8} - 2^{-1})$ = $1 - 2^{-7}$.

真值离散范围一般化, 假设总共有 n 位, 那么真值离散范围: [$-(1 - 2^{-n + 1})$, $1 - 2^{-n + 1}$], 总个数为 $2^n - 1$.

如 **编号 1 表格** 所示, 在位数增大时, 整数范围呈指数级增长. 小数总个数呈指数级增长, 小数范围变化比较小, . 因此在整数中数值位的大小主要影响数据的范围, 而在小数中数值位的大小主要影响数据的精度.

| (编号 1) 位数 | 有符号整数范围 (原码表示) | 有符号小数范围 (原码表示)     | 有符号小数总个数 (原码表示) |
| ------------- | ------------------------- | ----------------------------- | --------------------------- |
| 8             | [-127, 127]               | [-0.9921875, 0.9921875]       | 255                         |
| 9             | [-255, 255]               | [-0.99609375, 0.99609375]     | 511                         |
| 10            | [-511, 511]               | [-0.998046875, 0.998046875]   | 1023                        |
| 11            | [-1023, 1023]             | [-0.9990234375, 0.9990234375] | 2047                        |

此外, 由于在小数中范围是离散的, 且无论数值位的大小是多少, 范围都会包含 0, 因而通常会探讨离 0 最近的值是多少, 也就是分成负区间和正区间研究. 在原码中负区间和正区间是 y 轴对称的, 因此只需要研究正区间即可.

离 0 最近的正值是: 0000 0001, 即 $2^{-7}$. 由此可知正区间范围是: $[2^{-7}, 1 - 2^{-7}]$. 一般化范围则是: $[2^{-n+1}, 1 - 2^{-n+1}]$.

### 补码表示法

无论数值位的大小是多少, 模永远是 $2^0$. 实际上模由小数点的位置决定, 这里讨论的是纯小数, 小数点前没有数值位, 因此模是 $2^0$. 如果小数点前有一个数值位, 模就是 $2^1$.

补码的范围可以直接照搬整数补码的规律: 1000 0000 等于负模, 在这里等于 $-2^0$. 因此十进制的真值离散范围变成: [-1, $1 - 2^{-n + 1}$], 总个数为 $2^{n}$.

补码的范围也可以做个简单的推导, 由 **编号 1 展示** 可知, 真值离散范围是: [-1.000 0000, 0.111 1111], 十进制则是: [-1, $1 - 2^{-7}$]. 128 个补数对应 256 个真值. 和整数部分一样, 想要倒推真值, 就需要一个符号位记录补数是对应正真值还是负真值, 因此补码等于符号位 + 补数.

```
/* 编号: 1 */
  补数        真值
111 1111 - 0.111 1111, -0.000 0001
111 1110 - 0.111 1110, -0.000 0010
   ...
000 0010 - 0.000 0010, -0.111 1110
000 0001 - 0.000 0001, -0.111 1111
000 0000 - 0.000 0000, -1.000 0000
```

### 缺陷

定点数表示的范围过小, 如果有办法移动小数点的位置, 那么范围将有极大的扩展. 如 **编号 2 展示** 中所示, 第一行的真值是 $2^{-7}$, 最后一行的真值为 $2^{-1}$, 仅仅移动了小数点就让同一个段 bit (0000 0001) 表达了两个差值很大的真值. 浮点数改善了这个缺陷.

```
/* 编号: 2 */
0.000 0001
00.00 0001
000.0 0001
...
0000 00.01
0000 000.1
```
