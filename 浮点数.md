## 定点小数

这里讨论的小数指的是有符号的纯小数, 定点代表小数点的位置是固定的 (或者说, 是由某个规则约点的). 例如使用 8 bit 存储小数, 最高位是符号位, 其余是数值位, 小数点在符号位和数值位之间. 原码 0000 0001 的真值是 0.000 0001 (这里, 真值是二进制), 原码 1000 0001 的真值是 -0.000 0001. 此外, 下面都默认都使用 8 bit 存储小数.

### 原码表示法

原码离散范围: [1111 1111, 0111 1111], 对应真值离散范围: [-0.111 1111, 0.111 1111], 和整数原码一样 1000 0000, 0000 0000 都代表真值 0, 因而总共有 $2^8 - 1$ 种数据. 和整数不同的是, 小数的范围是离散的, 两个小数之间有无数个小数, 而我们只有 255 种数据. 因此, 无数个小数以原码形式存储时, 必须被映射为 255 种之一, 这也就是精度丢失.

十进制的真值离散范围: [$-(1 - 2^{-7})$, $1 - 2^{-7}$], 由等比数列求和公式 $(a_nq - a_1) / (q -1)$ 计算得到, 0.111 1111 = ($2^{-7} * 1/2 - 2^{-1}) / (1/2 - 1)$ = $-2 * (2^{-8} - 2^{-1})$ = $1 - 2^{-7}$.

真值离散范围一般化, 假设总共有 n 个数值位, 那么真值离散范围: [$-(1 - 2^{-n})$, $1 - 2^{-n}$], 总个数为 $2^{n+1} - 1$. 和整数不同的是, 在数值位增大时, 整数范围呈指数级增长. 小数总个数呈指数级增长, 小数范围变化比较小, 如 **编号 1 表格** 所示.

| (编号 1) 数值位数 | 有符号整数范围 (原码表示) | 有符号小数范围 (原码表示)     | 有符号小数总个数 (原码表示) |
| ------------------------ | ------------------------- | ----------------------------- | ------------------------- |
| 7                        | [-127, 127]               | [-0.9921875, 0.9921875]       | 255                       |
| 8                        | [-255, 255]               | [-0.99609375, 0.99609375]     | 511                       |
| 9                        | [-511, 511]               | [-0.998046875, 0.998046875]   | 1023                      |
| 10                       | [-1023, 1023]             | [-0.9990234375, 0.9990234375] | 2047                      |

### 补码表示法

首先无论数值位多大, 模的大小永远是 $2^0$, 实际上模的大小由小数点的位置决定, 这里讨论的是纯小数, 小数点前没有数值位. 因此模是 $2^0$, 如果小数点前有一个数值位, 模就是 $2^1$.

补码的范围可以直接照搬整数的规律, 即 1000 0000 代表真值 -1 而不是 0. 因此十进制的真值离散范围: [-1, $1 - 2^{-n}$], 总个数为 $2^{n+1}$. 这里简单推导下, 由 **编号 3 展示** 可知, 真值离散范围: [-1.000 0000, 0.111 1111], 十进制则是: [-1, $1 - 2^{-7}$]. 补数个数为 128, 所以总个数 256. 由于一个补数对应两个真值, 因此需要符号位来记录是正真值还是负真值. 因此补码等于符号位 + 补数.

```
/* 编号: 3 */
  补数        真值
111 1111 - 0.111 1111, -0.000 0001
111 1110 - 0.111 1110, -0.000 0010
   ...
000 0010 - 0.000 0010, -0.111 1110
000 0001 - 0.000 0001, -0.111 1111
000 0000 - 0.000 0000, -1.000 0000
```

### 缺陷

定点数表示的范围过小, 如果有办法移动小数点的位置, 那么范围将有极大的扩展. 例如 **编号 4 展示** 中所示, 第一行的真值是 $2^{-7}$, 最后一行的真值为 $2^{-1}$, 仅仅移动了小数点就让同一个段 bit 表达了差值很大的两个真值. 浮点数就是解决了这个问题.

```
/* 编号: 4 */
0.000 0001
00.00 0001
000.0 0001
...
0000 00.01
0000 000.1
```
